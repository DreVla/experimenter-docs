<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Mobile Messaging | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/mobile-messaging"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mobile Messaging | Experimenter Docs"><meta data-react-helmet="true" name="description" content="[fxios-actions-fml]//github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150"><meta data-react-helmet="true" property="og:description" content="[fxios-actions-fml]//github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/mobile-messaging"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-messaging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-messaging" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4e4a976a.css">
<link rel="preload" href="/assets/js/runtime~main.64916413.js" as="script">
<link rel="preload" href="/assets/js/main.b9efd645.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mana.mozilla.org/wiki/display/FJT/Project+Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Mana<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What&#x27;s Newsletter</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Experimentation Workflow</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/designing">Designing</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Implementing</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/experiment-owners">Experiment Owners</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/feature-definition">Feature Definition</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/a-b-experiments">A/B Experiments</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/custom-audiences">Custom Audiences</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/android-custom-targeting">Adding new targeting attributes to Android</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/ios-custom-targeting">Adding new targeting attributes to iOS</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Messaging Experiments</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/messaging/messaging-surfaces">Messaging Surfaces</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/messaging/display-logic">Messaging Display Logic</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a href="https://firefox-source-docs.mozilla.org/toolkit/components/messaging-system/docs/" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Triggers &amp; User Actions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/frequency-cap">Messaging System Frequency cap</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a href="https://firefox-source-docs.mozilla.org/browser/components/newtab/content-src/asrouter/docs/targeting-attributes.html" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Available Targeting<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-messaging">Mobile Messaging</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/configuring">Configuring</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/launching">Launching</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ending">Ending</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/analyzing">Analyzing</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deep Dives</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Cookbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Links</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frequently Asked Questions</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Mobile Messaging</h1></header><header><h1>Introduction</h1></header><p>The GleanPlumb messaging system is a feature of Firefox on iOS and Android, designed to send in-app messages directly to users without going through a release cycle.</p><p>It allows staff— most likely experiment owners, product owners, user research and marketing teams—</p><ul><li>to send messages to the user audiences, with rules about when to show them.</li><li>to experiment with those messages (the appearance or copy of the message)</li><li>to allow the user to respond to the message (either dismissing, or opening a specified URL)</li></ul><header><h1>About this document</h1></header><p>This document is a guide for staff who wish to send message users through the experimenter interface.</p><p>It is also a living document:</p><ul><li>the messaging system is under active development, and learning from its MVP.</li><li>attributes useful in triggers, and deeplink actions will accrue in each of the embedding apps.</li></ul><p>You can view a demo of sending a survey on mobile <a href="https://mozilla.zoom.us/rec/share/CafQjaLn09BtbPvOphePVizKe49IrRF2QHtYcc5zs4XlbmEhHzulcohmvC1WUV49.ZBKmiSNkaw7kbIeJ" target="_blank" rel="noopener noreferrer">here</a>
Access Passcode: 9Zx9Lg&amp;M   </p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="edit-history"></a>Edit history<a class="hash-link" href="#edit-history" title="Direct link to heading">#</a></h4><ul><li>Changed <code>is_default_browser</code> to <code>is_default_browser_string</code>.</li><li>Renamed Glean messages to match the implementation.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="scene-setting"></a>Scene setting<a class="hash-link" href="#scene-setting" title="Direct link to heading">#</a></h2><p>GleanPlumb is built on top of Nimbus, Mozilla&#x27;s experimentation platform. Nimbus allows you to send bits of configuration to application features from Experimenter, the web-application staff use to launch and manage experiments and rollouts.</p><p>Using Experimenter in the general case is documented elsewhere, so this document is specifically concerned with configuring the <code>messaging</code> feature, via the Branches screen.</p><p><img alt="my-first-message in the branch configuration screen" src="/assets/images/branch-config-60db22b0fa5c8c429e1f39774fc8d31f.png"></p><p>The messages that are sent are specified as JSON in the &quot;Value&quot; text area on this screen, so much of this document will consider this the user-interface for sending messages.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_RECENTLY_UPDATED&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Enhance your privacy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;text&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;We&#x27;ve improved our tracking protection, tap here to switch it on&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Make it so!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OPEN_SETTINGS_TRACKING_PROTECTION&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We will start with this simple example to introduce the concepts, then add more as we go.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="anatomy-of-a-message"></a>Anatomy of a message<a class="hash-link" href="#anatomy-of-a-message" title="Direct link to heading">#</a></h2><p>Messages have a number of components:</p><ul><li>the message key. In this example above, this is <code>my-first-message</code>. For most cases, these should be<ul><li>unique so as not to collide with other messages.</li><li>human readable. By convention, these are <code>kebab-case</code>.</li></ul></li><li>the <code>trigger</code>. This is the conditions that must be <code>true</code> for the message to be eligible to be displayed.</li><li>the content of a message. This is the <code>title</code> of the message, the <code>text</code> and the <code>button-label</code>.</li><li>the <code>action</code> that is performed if and when the user taps on the button.</li></ul><p>If any of these components are missing, then the message is considered <em>malformed</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="triggers"></a>Triggers<a class="hash-link" href="#triggers" title="Direct link to heading">#</a></h3><p>The app provides the messaging system with <a href="#list-of-attributes">attributes</a>. We use JEXL expressions to query these attributes.</p><p>To reduce errors and to allow re-use, the JEXL expressions are named. By convention, these names are in <code>SCREAMING_SNAKE_CASE</code>.</p><p>The <code>trigger</code> attribute of the message is an array of these named trigger expressions.</p><p>If all of these trigger expressions evaluate to <code>true</code>, then the message is said to be <em>eligible</em>.</p><ul><li><a href="#list-of-trigger-expressions">List of available trigger expressions</a></li><li><a href="#adding-custom-trigger-expressions">Adding custom trigger expressions</a></li></ul><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_RECENTLY_UPDATED&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the above example, only users who have updated their apps in the last 7 days <em>and</em> who are English speakers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="message-content"></a>Message content<a class="hash-link" href="#message-content" title="Direct link to heading">#</a></h3><p>The message content is provided as strings, and is what the user sees.</p><p>Only the <code>text</code> property is mandatory. If this is missing, then the message is said to be <em>malformed</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Enhance your privacy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;text&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;We&#x27;ve improved our tracking protection, tap here to switch it on&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Make it so!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If <code>title</code> is missing, then the title is not displayed.</p><p>If <code>button-label</code> is missing, then the button is not displayed, but the whole message is tappable.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="actions"></a>Actions<a class="hash-link" href="#actions" title="Direct link to heading">#</a></h3><p>Actions are performed when the user taps on the call to action (i.e. the button).</p><p>The actions are implemented as URLs, which may be deeplinks in to the app, web links, or deeplinks in to other apps.</p><p>To reduce errors and to allow re-use, action URLs can be named. By convention, these names are in <code>SCREAMING_SNAKE_CASE</code>.</p><ul><li><a href="#list-of-actions">List of available actions</a></li><li><a href="#adding-custom-actions">Adding custom actions</a></li></ul><p>If the specified <code>action</code> property contains a <code>://</code> it is treated as a bare URL, so one-off URLs may be specified.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="string-substiutions"></a>String substiutions<a class="hash-link" href="#string-substiutions" title="Direct link to heading">#</a></h4><p>Before the final URL is opened, a variable subsitution is made, so identifiers within a pair of braces may be made part of the URL.</p><p><a href="#list-of-attributes">Any attribute</a> that GleanPlumb knows about can be used. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;my-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://mozilla.org/fenix/{locale}/whatsnew/{app_version}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Additionally, the special <code>{uuid}</code> can be used to generate a new UUID. If detected, this will be recorded as an extra called <code>action-uuid</code> on the message&#x27;s <code>interaction</code> event.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://surveys.thirdparty.org/fenix-viewpoint/?client_id={uuid}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This allows the client&#x27;s anonymous survey results to match up to their Glean data while remaining anonymous to the third party.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="other-message-attributes"></a>Other message attributes<a class="hash-link" href="#other-message-attributes" title="Direct link to heading">#</a></h3><p>There are additional message attributes which don&#x27;t quite fit anywhere, yet. It is best to leave this unused. We&#x27;re looking for feedback during the MVP phase.</p><ul><li><code>style</code> – this is a string key into the <code>styles</code> object. It will code for visual style, and/or priority.</li></ul><p>Current values are <code>DEFAULT</code>, <code>PERSISTENT</code>, <code>WARNING</code>, <code>URGENT</code>.</p><p>This currently code for:</p><ul><li>the message <code>priority</code>. Messages will be shown in descending order of priority.</li><li>the <code>max-display-count</code>. Messages will be shown to the user for this number of sessions before the message expires.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="localization-of-messages"></a>Localization of messages<a class="hash-link" href="#localization-of-messages" title="Direct link to heading">#</a></h2><p>Localization of strings and messages is not fully developed in Nimbus: the intention is to integrate with the existing tooling for localizing strings.</p><p>For message content, you might use identifiers of pre-translated strings (in <a href="https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Frontend/Strings.swift#L60" target="_blank" rel="noopener noreferrer">Firefox for iOS</a>, <a href="https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/res/values/strings.xml" target="_blank" rel="noopener noreferrer">Firefox for Android</a>). This might be useful for very common phrases like OK, or Cancel.</p><p>However this relies on the exact translations either being coincidentally already in use by the app, or the experimental copy known about before the app was released. For several reasons, we do not recommend this approach.</p><p>Instead, we can add multiple messages which do the same thing, but in different langauges.</p><p>The <code>messages</code> property is a JSON object, so can accept multiple messages, each with different locale triggers.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-en&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Go to settings&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-de&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_DE_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Einstellungen öffnen&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-es&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_ES_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ir a ajustes&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-fr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_FR_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ouvrir les paramètres&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For each of the messages,</p><ul><li>the message key should have a common prefix. This becomes important when experimenting with messages.</li><li>the triggers should be the same list of named expressions, but appending the trigger-expression to select for language.</li></ul><p>In this manner the locale can be only one value at a time, and only one version of the mesaage is eligible for display at any one time.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="experimenting-with-messages"></a>Experimenting with messages<a class="hash-link" href="#experimenting-with-messages" title="Direct link to heading">#</a></h2><p>So far, we have talked about using Experimenter to push out messages as single branch experiments.</p><p>When running experiments, we&#x27;ll need to configure two or more branches. By convention, each branch will have the same message keys (in the example below <code>my-first-message</code>.</p><p>We should also tell the system that a particular message is under experiment.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> … </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message-under-experiment&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-first-message&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is important that the message key matches the <code>message-under-experiment</code> value: when message with this key is displayed to the user, Nimbus exposure events are recorded.</p><p>N.B. It&#x27;s a feature of Nimbus to ensure that any one user will only be exposed to one experimental message at a time.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="experimenting-with-localized-messages"></a>Experimenting with localized messages<a class="hash-link" href="#experimenting-with-localized-messages" title="Direct link to heading">#</a></h3><p>We saw when <a href="#localization-of-messages">localizing messages</a> that the branch provided different messages based on adding additional trigger expressions.</p><p>It is important that:</p><ul><li>each of the different languages represented in one branch is represented in all branches.</li><li>for the messages in each branch, no more than one message will be <em>eligible</em> for display at any one time. In the example below, the user&#x27;s locale can only be set to one language at a time, so only one message is triggered at any one time.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-en&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-de&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_DE_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-es&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_ES_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-fr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_FR_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;message-under-experiment&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-l10n-message-&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If the <code>message-under-experiment</code> property ends in a <code>-</code>, then any message with a message key which is prefixed by that value is considered under experiment.</p><p>Since these triggers are mutually exclusive, the user will only ever be exposed to one message under experiment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="control-messages"></a>Control messages<a class="hash-link" href="#control-messages" title="Direct link to heading">#</a></h3><p>For most messages, we&#x27;ll need to specify a control message.</p><p>The control is specified in a similar way to others:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> … </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Because <code>is-control</code> set to <code>true</code>, we don&#x27;t need to specify a value for <code>message-under-experiment</code>. The system can deduce that the message is under experiment.</p><p><strong>Important</strong>: The control message must be <em>eligible</em> whenever the treatment message would have been. This means that the <code>trigger</code> value of the control must match the <code>trigger</code> value of the treatment message.</p><p>For localized messages, we will need to provide a set of contol messages that matches the treatment messages, so that the control message is triggered for all and only the same circumstances as the treatment.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-en&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-de&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_DE_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-es&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_ES_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-l10n-message-fr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_FR_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="displaying-the-control-message"></a>Displaying the control message<a class="hash-link" href="#displaying-the-control-message" title="Direct link to heading">#</a></h3><p>The control message is the placebo, so doesn&#x27;t make any sense to display to the user, so when a control message is selected for display, what should a message surface actually display?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;my-first-message&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> … </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;is-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;on-control&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;show-next-message&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>on-control</code> property controls what happens in this case:</p><ul><li><code>show-next-message</code> causes the next eligible message to be displayed.<ul><li>other messages may come from the app itself or from rollouts that other staff are doing.</li></ul></li><li><code>show-none</code> causes the message surface not to display anything at all.</li></ul><p>By default, <code>on-control</code> is set to <code>show-next-message</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="events-emitted"></a>Events emitted<a class="hash-link" href="#events-emitted" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="nimbus-events"></a>Nimbus Events<a class="hash-link" href="#nimbus-events" title="Direct link to heading">#</a></h3><p>Nimbus emits events via Glean for all experiments that the user is enrolled in.</p><p>Enrollment is a decision taken at start-up about whether the user is eligible for the experiment (i.e. fits the experiment targeting criteria), and is chosen to part of the experiment cohort, i.e. is chosen to be have one of the branches).</p><p>Exposure evnts happen when the user is enrolled in the experiment, and the subsequently exposed to the treatment (or the control).</p><p>In the case of messaging, exposure events are emitted when the user is enrolled, and the message in one of the message is shown. For other messages that aren&#x27;t from an experiment, no exposure events are emitted.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="message-events"></a>Message Events<a class="hash-link" href="#message-events" title="Direct link to heading">#</a></h3><p>Each of the following events is emitted— via Glean— at certain points while the message exists on the user&#x27;s device.</p><ul><li><code>message_shown</code>: the message is shown to the user.</li><li><code>message_clicked</code>: the user has tapped on the button, or the message itself if a button doesn&#x27;t exist.<ul><li>an <code>action-uuid</code> is given as an extra.</li></ul></li><li><code>malformed</code>: the message sender has somehow made an error specifying a particular message. e.g.</li><li><code>message_dismissed</code>: the message was shown to the user, and tapped the dismiss action. This is message surface dependent.</li><li><code>message_expired</code>: The message has been shown to the user for a number of sessions, and not been interacted with. We therefore expire the message.</li></ul><p>Each message has a <code>message-key</code> extra.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="extending-the-system"></a>Extending the system<a class="hash-link" href="#extending-the-system" title="Direct link to heading">#</a></h2><p>Much of the system relies on Nimbus <a href="/cookbook/fml/growable-collections">merging together JSON objects</a>. We have seen this in the <code>messages</code> object which can contain messages from the default configuration, rollouts, and experiments.</p><p>We can also add to the <code>actions</code>, <code>triggers</code> and <code>styles</code> object in the same way. This is covered below, and do not need an engineer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="adding-attributes"></a>Adding attributes<a class="hash-link" href="#adding-attributes" title="Direct link to heading">#</a></h3><p>Attributes require an application engineer to add values to the JSON object that is passed to the messaging subsystem.</p><ul><li><a href="https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/java/org/mozilla/fenix/gleanplumb/CustomAttributeProvider.kt#L29" target="_blank" rel="noopener noreferrer">Firefox for Android</a></li><li><a href="#missing-link">Firefox for iOS</a></li></ul><p>Once in this JSON, this becomes available to JEXL expressions and string subsitution.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="adding-custom-trigger-expressions"></a>Adding custom trigger expressions<a class="hash-link" href="#adding-custom-trigger-expressions" title="Direct link to heading">#</a></h3><p>Trigger expressions can be added on a per-message basis, by adding to the <code>triggers</code> object.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;triggers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;DATE_IS_CHRISTMAS&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&#x27;-12-25&#x27; in date_string&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;happy-christmas-en&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DATE_IS_CHRISTMAS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Happy Christmas&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;happy-christmas-fr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DATE_IS_CHRISTMAS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_FR_SPEAKER&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;title&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Joyeux Noel&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>DATE_IS_CHRISTMAS</code> is now available as a trigger expression in all the messages in the branch.</p><p>It can be used in all messages only when it is added back to the application&#x27;s <a href="#list-of-trigger-expressions">list of trigger expressions</a>.</p><p>Once a branch has been rolled out, then <code>DATE_IS_CHRISTMAS</code> becomes available to all messages.</p><p>Finally, it can be rolled back in to the product by adding it to the <code>nimbus.fml.yaml</code> file, i.e. in <a href="https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139" target="_blank" rel="noopener noreferrer">Firefox for iOS</a> and <a href="https://github.com/mozilla-mobile/fenix/blob/main/nimbus.fml.yaml#L115" target="_blank" rel="noopener noreferrer">Firefox for Android</a>.</p><p>Care should be taken to test this new trigger expression before deploying it.</p><p>Suitable tools to prototype these expressions:</p><ul><li>This <a href="https://czosel.github.io/jexl-playground/#/?context=%7B%0A%20%20%22app_name%22%3A%20%22fenix%22%2C%0A%20%20%22app_id%22%3A%20%22org.mozilla.fenix%22%2C%0A%20%20%22channel%22%3A%20%22release%22%2C%0A%20%20%22app_version%22%3A%20%22101.0.0%22%2C%0A%20%20%22device_manufacturer%22%3A%20%22Samsung%22%2C%0A%20%20%22device_model%22%3A%20%22Note%205%22%2C%0A%20%20%22locale%22%3A%20%22es-US%22%2C%0A%20%20%22os%22%3A%20%22Android%22%2C%0A%20%20%22os_version%22%3A%20%2213.1%22%2C%0A%0A%20%20%22is_default_browser%22%3A%20true%2C%0A%20%20%22date_string%22%3A%20%222022-06-19%22%0A%7D&amp;input=&#x27;US&#x27;%20in%20locale%20%26%26%20&#x27;-06-19&#x27;%20in%20date_string%0A&amp;transforms=%7B%7D" target="_blank" rel="noopener noreferrer">JEXL playground</a> is setup to prototype expressions against existing attributes.</li><li><a href="https://github.com/TomFrost/Jexl#all-the-details" target="_blank" rel="noopener noreferrer">JEXL documentation</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="adding-custom-actions"></a>Adding custom actions<a class="hash-link" href="#adding-custom-actions" title="Direct link to heading">#</a></h3><p>All actions are implemented as URLs. Ad-hoc URLs can be used for one-off messages, but <em>must</em> contain the scheme and separator: e.g. <code>https://</code>.</p><p>URLs that start with <code>://</code> are taken as deeplinks into the app.</p><p>You can add URLs as named actions for use by multiple messages.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;actions&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;INSTALL_VPN&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;market://details?id=org.mozilla.firefox.vpn&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;upsell-vpn-en&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;VPN maybe?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSTALL_VPN&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_EN_SPEAKER&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;upsell-vpn-fr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;button-label&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;VPN peut-être?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSTALL_VPN&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;trigger&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;USER_FR_SPEAKER&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Deeplinks are implemented by the application developers in the app.</p><p>There are two parts to making new actions for messages:</p><ul><li>implementing them so that the app can respond to deeplinks.</li><li>making those links accessible to messages, by adding them to the <code>nimbus.fml.yaml</code> file.</li></ul><p>For example:</p><ul><li>Firefox for Android:<ul><li><a href="https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/AndroidManifest.xml#L91-L126" target="_blank" rel="noopener noreferrer">Deeplinks in the <code>AndroidManifest.xml</code></a>.</li><li>Corresponding <a href="https://github.com/mozilla-mobile/fenix/blob/main/nimbus.fml.yaml#L126" target="_blank" rel="noopener noreferrer"><code>actions</code> in the <code>nimbus.fml.yaml</code></a>. Note that the <code>deepLinkScheme</code> is omitted in the FML.</li></ul></li><li>Firefox for iOS:<ul><li><a href="https://github.com/mozilla-mobile/firefox-ios/blob/main/Client/Application/NavigationRouter.swift#L114-L131" target="_blank" rel="noopener noreferrer">Deeplinks in the <code>NavigationRouter.swift</code></a>.</li><li>Corresponding <a href="https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L150" target="_blank" rel="noopener noreferrer"><code>actions</code> in the <code>nimbus.fml.yaml</code></a>. Note that the <code>deepLinkScheme</code> is omitted in the FML.</li></ul></li></ul><p>If the implementation stage has been done, but the FML part hasn&#x27;t, you can add the action as part of the branch configuration.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;actions&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;FXA_SIGN_IN&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;://fxa-signin?signin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;messages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;upsell-fxa&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            …</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;action&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;FXA_SIGN_IN&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Custom actions can be used in all messages only when they are added back to the application&#x27;s <a href="#list-of-actions">list of actions</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="lifecycle-of-a-message"></a>Lifecycle of a message<a class="hash-link" href="#lifecycle-of-a-message" title="Direct link to heading">#</a></h2><p>Like all Nimbus enabled features the messaging system configuration (messages, triggers, actions, styles) is likely to undergo a number of phases:</p><ul><li>experimentation</li><li>rollout the successful messages to the rest of the audience</li><li>fold-back into the code: copy the successful JSON branches into the nimbus.fml.yaml files where they will become part of the next release.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="appendices"></a>Appendices<a class="hash-link" href="#appendices" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="list-of-trigger-expressions"></a>List of trigger expressions<a class="hash-link" href="#list-of-trigger-expressions" title="Direct link to heading">#</a></h3><p>These trigger expressions are based upon the default set of attrbutes available to Nimbus.</p><table><thead><tr><th>Expression name</th><th>JEXL expression</th><th>Discussion</th></tr></thead><tbody><tr><td><code>USER_RECENTLY_INSTALLED</code></td><td><code>days_since_install &lt; 7</code></td><td></td></tr><tr><td><code>USER_RECENTLY_UPDATED</code></td><td><code>days_since_update &lt; 7 &amp;&amp; days_since_install != days_since_update</code></td><td></td></tr><tr><td><code>USER_TIER_ONE_COUNTRY</code></td><td>`(&#x27;US&#x27; in locale</td><td></td></tr><tr><td><code>USER_EN_SPEAKER</code></td><td><code>&#x27;en&#x27; in locale</code></td><td></td></tr><tr><td><code>USER_DE_SPEAKER</code></td><td><code>&#x27;de&#x27; in locale</code></td><td></td></tr><tr><td><code>USER_FR_SPEAKER</code></td><td><code>&#x27;fr&#x27; in locale</code></td><td></td></tr><tr><td><code>DEVICE_ANDROID</code></td><td><code>os == &#x27;Android&#x27;</code></td><td></td></tr><tr><td><code>DEVICE_IOS</code></td><td><code>os == &#x27;iOS&#x27;</code></td><td></td></tr><tr><td><code>ALWAYS</code></td><td><code>true</code></td><td></td></tr><tr><td><code>NEVER</code></td><td><code>false</code></td><td></td></tr></tbody></table><p>These trigger expressions are application specific:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Firefox for Android</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Firefox for iOS</li></ul><div class="margin-vert--md"><div role="tabpanel"><table><thead><tr><th>Expression name</th><th>JEXL expression</th><th>Discussion</th></tr></thead><tbody><tr><td><code>I_AM_DEFAULT_BROWSER</code></td><td><code>is_default_browser_string == &#x27;true&#x27; </code></td><td></td></tr><tr><td><code>I_AM_NOT_DEFAULT_BROWSER</code></td><td><code>is_default_browser_string == &#x27;false&#x27;</code></td><td></td></tr></tbody></table><p>It is possible this table is out of date. The definitive source of truth for this in <a href="https://github.com/mozilla-mobile/fenix/blob/main/nimbus.fml.yaml#L115" target="_blank" rel="noopener noreferrer">the code</a> itself.</p></div><div role="tabpanel" hidden=""><table><thead><tr><th>Expression name</th><th>JEXL expression</th><th>Discussion</th></tr></thead></table><p>It is possible this table is out of date. The definitive source of truth for this in <a href="https://github.com/mozilla-mobile/firefox-ios/blob/main/nimbus.fml.yaml#L139" target="_blank" rel="noopener noreferrer">the code</a> itself.</p></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="list-of-actions"></a>List of actions<a class="hash-link" href="#list-of-actions" title="Direct link to heading">#</a></h3><p>These all correspond to the existing deeplinks in each app, so are entirely app specific.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Firefox for Android</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Firefox for iOS</li></ul><div class="margin-vert--md"><div role="tabpanel"><table><thead><tr><th>Action</th><th>Description</th><th>Corresponding Deeplink</th></tr></thead><tbody><tr><td><code>ENABLE_PRIVATE_BROWSING</code></td><td></td><td><code>firefox://enable_private_browsing</code></td></tr><tr><td><code>INSTALL_SEARCH_WIDGET</code></td><td></td><td><code>firefox://install_search_widget</code></td></tr><tr><td><code>MAKE_DEFAULT_BROWSER</code></td><td></td><td><code>firefox://make_default_browser</code></td></tr><tr><td><code>OPEN_SETTINGS_ACCESSIBILITY</code></td><td></td><td><code>firefox://settings_accessibility</code></td></tr><tr><td><code>OPEN_SETTINGS_ADDON_MANAGER</code></td><td></td><td><code>firefox://settings_addon_manager</code></td></tr><tr><td><code>OPEN_SETTINGS_DELETE_BROWSING_DATA</code></td><td></td><td><code>firefox://settings_delete_browsing_data</code></td></tr><tr><td><code>OPEN_SETTINGS_LOGINS</code></td><td></td><td><code>firefox://settings_logins</code></td></tr><tr><td><code>OPEN_SETTINGS_NOTIFICATIONS</code></td><td></td><td><code>firefox://settings_notifications</code></td></tr><tr><td><code>OPEN_SETTINGS_PRIVACY</code></td><td></td><td><code>firefox://settings_privacy</code></td></tr><tr><td><code>OPEN_SETTINGS_SEARCH_ENGINE</code></td><td></td><td><code>firefox://settings_search_engine</code></td></tr><tr><td><code>OPEN_SETTINGS_TRACKING_PROTECTION</code></td><td></td><td><code>firefox://settings_tracking_protection</code></td></tr><tr><td><code>OPEN_SETTINGS_WALLPAPERS</code></td><td></td><td><code>firefox://settings_wallpapers</code></td></tr><tr><td><code>OPEN_SETTINGS</code></td><td></td><td><code>firefox://settings</code></td></tr><tr><td><code>TURN_ON_SYNC</code></td><td></td><td><code>firefox://turn_on_sync</code></td></tr><tr><td><code>VIEW_BOOKMARKS</code></td><td></td><td><code>firefox://urls_bookmarks</code></td></tr><tr><td><code>VIEW_COLLECTIONS</code></td><td></td><td><code>firefox://home_collections</code></td></tr><tr><td><code>VIEW_HISTORY</code></td><td></td><td><code>firefox://urls_history</code></td></tr><tr><td><code>VIEW_HOMESCREEN</code></td><td></td><td><code>firefox://home</code></td></tr></tbody></table></div><div role="tabpanel" hidden=""><table><thead><tr><th>Action</th><th>Description</th><th>Corresponding Deeplink</th></tr></thead><tbody><tr><td><code>ENABLE_PRIVATE_BROWSING</code></td><td></td><td><code>firefox://deep-link?url=homepanel/new-private-tab</code></td></tr><tr><td><code>MAKE_DEFAULT_BROWSER</code></td><td></td><td><code>firefox://deep-link?url=default-browser/system-settings</code></td></tr><tr><td><code>OPEN_SETTINGS_EMAIL</code></td><td></td><td><code>firefox://deep-link?url=settings/mailto</code></td></tr><tr><td><code>OPEN_SETTINGS_FXA</code></td><td></td><td><code>firefox://deep-link?url=settings/fxa</code></td></tr><tr><td><code>OPEN_SETTINGS_HOMESCREEN</code></td><td></td><td><code>firefox://deep-link?url=settings/homepage</code></td></tr><tr><td><code>OPEN_SETTINGS_NEW_TAB</code></td><td></td><td><code>firefox://deep-link?url=settings/newtab</code></td></tr><tr><td><code>OPEN_SETTINGS_PRIVACY</code></td><td></td><td><code>firefox://deep-link?url=settings/clear-private-data</code></td></tr><tr><td><code>OPEN_SETTINGS_SEARCH_ENGINE</code></td><td></td><td><code>firefox://deep-link?url=settings/search</code></td></tr><tr><td><code>OPEN_SETTINGS_THEME</code></td><td></td><td><code>firefox://deep-link?url=settings/theme</code></td></tr><tr><td><code>OPEN_SETTINGS_WALLPAPERS</code></td><td></td><td><code>firefox://deep-link?url=settings/wallpaper</code></td></tr><tr><td><code>OPEN_SETTINGS</code></td><td></td><td><code>firefox://deep-link?url=settings/general</code></td></tr><tr><td><code>VIEW_BOOKMARKS</code></td><td></td><td><code>firefox://deep-link?url=homepanel/bookmarks</code></td></tr><tr><td><code>VIEW_DOWNLOADS</code></td><td></td><td><code>firefox://deep-link?url=homepanel/downloads</code></td></tr><tr><td><code>VIEW_HISTORY</code></td><td></td><td><code>firefox://deep-link?url=homepanel/history</code></td></tr><tr><td><code>VIEW_READING_LIST</code></td><td></td><td><code>firefox://deep-link?url=homepanel/reading-list</code></td></tr><tr><td><code>VIEW_TOP_SITES</code></td><td></td><td><code>firefox://deep-link?url=homepanel/top-sites</code></td></tr></tbody></table></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="list-of-attributes"></a>List of attributes<a class="hash-link" href="#list-of-attributes" title="Direct link to heading">#</a></h3><p>By convention these are in <code>snake_case</code>.</p><p>These attributes are defined by the Nimbus SDK.</p><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>app_name</code></td><td>string</td><td></td></tr><tr><td><code>app_id</code></td><td>string</td><td></td></tr><tr><td><code>channel</code></td><td>string</td><td></td></tr><tr><td><code>app_version</code></td><td>string</td><td></td></tr><tr><td><code>app_build</code></td><td>string</td><td></td></tr><tr><td><code>architecture</code></td><td>string</td><td></td></tr><tr><td><code>device_manufacturer</code></td><td>string</td><td></td></tr><tr><td><code>device_model</code></td><td>string</td><td></td></tr><tr><td><code>locale</code></td><td>string</td><td></td></tr><tr><td><code>os</code></td><td>string</td><td></td></tr><tr><td><code>os_version</code></td><td>string</td><td></td></tr><tr><td><code>android_sdk_version</code></td><td>string</td><td></td></tr><tr><td><code>debug_tag</code></td><td>string</td><td></td></tr><tr><td><code>installation_date</code></td><td>string</td><td></td></tr><tr><td><code>home_directory</code></td><td>string</td><td></td></tr></tbody></table><p>These attributes are application specific.</p><p>Unfortunately, the JEXL evaluator used does not have support for <a href="https://github.com/mozilla/jexl-rs/issues/22" target="_blank" rel="noopener noreferrer">boolean equality</a> or <a href="https://github.com/mozilla/jexl-rs/issues/15" target="_blank" rel="noopener noreferrer">negation</a>,
so boolean attributes should be simulated with strings or integers.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Firefox for Android</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Firefox for iOS</li></ul><div class="margin-vert--md"><div role="tabpanel"><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>is_default_browser_string</code></td><td>string</td><td>Should change to boolean on fixing <a href="https://github.com/mozilla/jexl-rs/issues/22" target="_blank" rel="noopener noreferrer"><code>==</code></a> and <a href="https://github.com/mozilla/jexl-rs/issues/15" target="_blank" rel="noopener noreferrer"><code>!</code></a></td></tr><tr><td><code>date_string</code></td><td>string</td><td>In YYYY-MM-DD format</td></tr></tbody></table><p>It is possible this table is out of date. The definitive source of truth for this in <a href="https://github.com/mozilla-mobile/fenix/blob/main/app/src/main/java/org/mozilla/fenix/gleanplumb/CustomAttributeProvider.kt#L29" target="_blank" rel="noopener noreferrer">the code</a> itself.</p></div><div role="tabpanel" hidden=""><table><thead><tr><th>Attribute</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>date_string</code></td><td>string</td><td>In YYYY-MM-DD format</td></tr></tbody></table><p>It is possible this table is out of date. The definitive source of truth for this in <a href="#missing-link">the code</a> itself.</p></div></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Русский военный корабль, иди на хуй</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/messaging/gleanplumb.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/frequency-cap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Messaging System Frequency cap</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/configuring"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuring »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scene-setting" class="table-of-contents__link">Scene setting</a></li><li><a href="#anatomy-of-a-message" class="table-of-contents__link">Anatomy of a message</a><ul><li><a href="#triggers" class="table-of-contents__link">Triggers</a></li><li><a href="#message-content" class="table-of-contents__link">Message content</a></li><li><a href="#actions" class="table-of-contents__link">Actions</a></li><li><a href="#other-message-attributes" class="table-of-contents__link">Other message attributes</a></li></ul></li><li><a href="#localization-of-messages" class="table-of-contents__link">Localization of messages</a></li><li><a href="#experimenting-with-messages" class="table-of-contents__link">Experimenting with messages</a><ul><li><a href="#experimenting-with-localized-messages" class="table-of-contents__link">Experimenting with localized messages</a></li><li><a href="#control-messages" class="table-of-contents__link">Control messages</a></li><li><a href="#displaying-the-control-message" class="table-of-contents__link">Displaying the control message</a></li></ul></li><li><a href="#events-emitted" class="table-of-contents__link">Events emitted</a><ul><li><a href="#nimbus-events" class="table-of-contents__link">Nimbus Events</a></li><li><a href="#message-events" class="table-of-contents__link">Message Events</a></li></ul></li><li><a href="#extending-the-system" class="table-of-contents__link">Extending the system</a><ul><li><a href="#adding-attributes" class="table-of-contents__link">Adding attributes</a></li><li><a href="#adding-custom-trigger-expressions" class="table-of-contents__link">Adding custom trigger expressions</a></li><li><a href="#adding-custom-actions" class="table-of-contents__link">Adding custom actions</a></li></ul></li><li><a href="#lifecycle-of-a-message" class="table-of-contents__link">Lifecycle of a message</a></li><li><a href="#appendices" class="table-of-contents__link">Appendices</a><ul><li><a href="#list-of-trigger-expressions" class="table-of-contents__link">List of trigger expressions</a></li><li><a href="#list-of-actions" class="table-of-contents__link">List of actions</a></li><li><a href="#list-of-attributes" class="table-of-contents__link">List of attributes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.64916413.js"></script>
<script src="/assets/js/main.b9efd645.js"></script>
</body>
</html>