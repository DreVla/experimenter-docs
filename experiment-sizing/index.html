<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Sizing Experiments Using Mozanalysis | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/experiment-sizing"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Sizing Experiments Using Mozanalysis | Experimenter Docs"><meta data-react-helmet="true" name="description" content="This page gives an overview of how Mozanalysis can be used to do experiment sizing. [Mozanalysis] is a library used to standardize experiment analysis at Mozilla. Mozanalysis contains the statistical tools used by [Jetstream] to produce results from experiments, as well as tools to pull historical data from BigQuery to calculated necessary sample sizes to carry out experiments."><meta data-react-helmet="true" property="og:description" content="This page gives an overview of how Mozanalysis can be used to do experiment sizing. [Mozanalysis] is a library used to standardize experiment analysis at Mozilla. Mozanalysis contains the statistical tools used by [Jetstream] to produce results from experiments, as well as tools to pull historical data from BigQuery to calculated necessary sample sizes to carry out experiments."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/experiment-sizing"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/experiment-sizing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/experiment-sizing" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3554915a.css">
<link rel="preload" href="/assets/js/runtime~main.fdfa36cd.js" as="script">
<link rel="preload" href="/assets/js/main.f5761b61.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11470446/Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What&#x27;s Newsletter</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/access">Experiment Reviewers</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Data Scientists</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/data-scientists">Experimentation for data scientists</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/telemetry">Telemetry for Experiments</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/validating-experiments">Validating Experiments</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/experiment-sizing">Sizing Experiments Using Mozanalysis</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Engineers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/for-product">Product Managers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/for-leadership">Leadership</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Workflow</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deep Dives</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Cookbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Links</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frequently Asked Questions</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Sizing Experiments Using Mozanalysis</h1></header><p>This page gives an overview of how Mozanalysis can be used to do experiment sizing. <strong><a href="https://github.com/mozilla/mozanalysis" target="_blank" rel="noopener noreferrer">Mozanalysis</a></strong> is a library used to standardize experiment analysis at Mozilla. Mozanalysis contains the statistical tools used by <a href="/jetstream/jetstream">Jetstream</a> to produce results from experiments, as well as tools to pull historical data from BigQuery to calculated necessary sample sizes to carry out experiments.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="experiment-sizing-paradigm"></a>Experiment sizing paradigm<a class="hash-link" href="#experiment-sizing-paradigm" title="Direct link to heading">#</a></h2><p>Experiment sizing in Mozanalysis retrieves historical data from BigQuery in a way that mimics how experiment enrollment and analysis is conducted by <a href="/jetstream/jetstream">Jetstream</a>: an enrollment period is defined, during which clients that satisfy certain target conditions are recorded; following enrollment, metrics are calculated for those clients over a defined analysis period. Following collection of metrics, sample size calculation is performed that corresponds to the statistical tests to be used in analyzing the eventual experiment.</p><img src="/img/mozanalysis/mozanalysis-sizing.png" alt="Mozanalysis sizing workflow" class="img-lg"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="enrollment-and-analysis"></a>Enrollment and analysis<a class="hash-link" href="#enrollment-and-analysis" title="Direct link to heading">#</a></h3><p>Similar to how experiments use an enrollment period to select clients for a study before collecting metrics for a period of time, Mozanalysis experiment sizing records all clients that satisfy the target conditions during an enrollment period, set by the user based on the analysis start date and the number of dates to enroll. Metrics are then recorded for a user-defined number of days for the analysis.</p><img src="/img/mozanalysis/enrollment-period.png" alt="Analysis with an enrollment period" class="img-lg"><p>An alternative to using an enrollment period to select clients is to use continuous enrollment, where any client that satisfies the targeting criteria during the entire analysis period is enrolled; metrics are collected from each client&#x27;s enrollment date to the end of the analysis period.</p><img src="/img/mozanalysis/continuous-enrollment.png" alt="Analysis with continuous enrollment" class="img-lg"><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="time-series-of-metrics"></a>Time series of metrics<a class="hash-link" href="#time-series-of-metrics" title="Direct link to heading">#</a></h3><p>In some cases, experiments will require client-level time series data. Mozanalysis can split the analysis period into time series periods (either daily, weekly, or monthly).</p><img src="/img/mozanalysis/time-series.png" alt="Time series metrics" class="img-lg"><p>The time series data returned will contain a row for each client for each time series period, so the number of rows in the time series results will be (number of periods) times larger than the results for a single analysis window. Mozanalysis offers a few options to retrieve this data:</p><ol><li>Download the entire set directly: Mozanalysis will warn the user about the approximate size of the data set they will download.</li><li>Download the data in chunks: Analysis periods in the time series are keyed by start dates, and the data for each period can be downloaded separately using this key.</li><li>Calculate aggregated metrics in BQ before downloading: A BQ aggregate function can be used to calculate within-analysis-period statistics before downloading; this will drastically reduce the size of the data, to (number of periods) rows, and is recommended whenever possible.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="targets-and-metrics"></a>Targets and metrics<a class="hash-link" href="#targets-and-metrics" title="Direct link to heading">#</a></h2><p>Selecting clients for analysis is accomplished by using the <a href="https://github.com/mozilla/mozanalysis/tree/main/src/mozanalysis/segments" target="_blank" rel="noopener noreferrer"><code>Segment</code></a> objects in Mozanalysis; users can either reuse segments that currently exists in Mozanalysis or by defining one at runtime. Segments consist of a data source, either a table or view in BigQuery, and a SELECT expression to filter that data source; this SELECT expression must include a SQL aggregate function.</p><p>Similarly, Mozanalysis experiment sizing reuses <code>Metric</code> objects from <a href="/jetstream/metrics">Jetstream</a>, and users can reuse metrics that are currently implemented in <a href="https://github.com/mozilla/mozanalysis/tree/main/src/mozanalysis/metrics" target="_blank" rel="noopener noreferrer">Mozanalysis</a> or <a href="https://github.com/mozilla/jetstream-config" target="_blank" rel="noopener noreferrer">jetstream-config</a>, or users can define their own at runtime.</p><p>Metrics and target segments are passed to Mozanalysis experiment sizing as lists of <code>Segment</code> or <code>Metric</code> objects; users may include multiple of each in the analysis. When multiple <code>Segment</code> objects are used, Mozanalysis identifies clients that satisfy the conditions of <strong>all</strong> targets in the list. If users would like to run analyses where <code>Segment</code>s should be joined with OR rather than AND, multiple experiment sizing tasks should be completed, for each condition in the OR statement, and aggregate the returned results from each separate study.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="implemented-sample-size-calculators"></a>Implemented sample size calculators<a class="hash-link" href="#implemented-sample-size-calculators" title="Direct link to heading">#</a></h2><p>Mozanalysis contains functions that take the results from pulling historical data and the list of metrics contained in the results and produce sample size estimates for each metric, given the desired power, significance level, and relative effect size expected from the change, a percent change in a statistic of the metric. The following tests have sample size calculators implemented:</p><ul><li>Z or T test for difference in means for independent samples</li><li>Z test for difference in proportions for independent samples</li><li>Test for difference of Poisson rates</li><li>Empirical effect size Wilcoxen-Mann-Whitney U test, based on an effect size calculated as the 90th percentile of week-to-week changes in the metric</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="example-colab-notebooks"></a>Example Colab notebooks<a class="hash-link" href="#example-colab-notebooks" title="Direct link to heading">#</a></h2><ol><li>Example with explanations for setting up sizing for a simple experiment <a href="https://colab.research.google.com/drive/1VQDrnVWvR_r-oKD8vD3hwNcZWx8Txg1N?usp=sharing" target="_blank" rel="noopener noreferrer">(link)</a></li><li>Replicating the sizing for the MR holdback <a href="https://colab.research.google.com/drive/1r14UMw_lEjtiyc0VVEvQuhadrDLzIyzn?usp=sharing" target="_blank" rel="noopener noreferrer">(link)</a></li><li>Sizing a mobile experiment <a href="https://colab.research.google.com/drive/1wUdfqCoB-mN7Gk1b6_zkAd2KWu8dp8V_?usp=sharing" target="_blank" rel="noopener noreferrer">(link)</a></li><li>Replicating sizing for Waldo, which uses continuous enrollment <a href="https://colab.research.google.com/drive/1_R4zBUnucRPmHwIVLlPTYInDZwTbCn-F?usp=sharing" target="_blank" rel="noopener noreferrer">(link)</a></li><li>Pulling time series historical data and sizing with empirical sample size calculation <a href="https://colab.research.google.com/drive/1-XT2DMfGSqiCS18yGPIGCs_YWg75qZzn?usp=sharing" target="_blank" rel="noopener noreferrer">(link)</a></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/data-scientists/experiment-sizing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/validating-experiments"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Validating Experiments</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/for-engineers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Engineers »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#experiment-sizing-paradigm" class="table-of-contents__link">Experiment sizing paradigm</a><ul><li><a href="#enrollment-and-analysis" class="table-of-contents__link">Enrollment and analysis</a></li><li><a href="#time-series-of-metrics" class="table-of-contents__link">Time series of metrics</a></li></ul></li><li><a href="#targets-and-metrics" class="table-of-contents__link">Targets and metrics</a></li><li><a href="#implemented-sample-size-calculators" class="table-of-contents__link">Implemented sample size calculators</a></li><li><a href="#example-colab-notebooks" class="table-of-contents__link">Example Colab notebooks</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fdfa36cd.js"></script>
<script src="/assets/js/main.f5761b61.js"></script>
</body>
</html>