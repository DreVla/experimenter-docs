<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Behavioral Targeting | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/mobile-behavioral-targeting"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Behavioral Targeting | Experimenter Docs"><meta data-react-helmet="true" name="description" content="Behavioral targeting is a term used to describe a set of jexl transforms which can be used to target specific user behaviors. User behaviors might be the user opened the app, the user logged in, the user navigated to a specific view, or any user-triggered event that has Glean metrics associated with it."><meta data-react-helmet="true" property="og:description" content="Behavioral targeting is a term used to describe a set of jexl transforms which can be used to target specific user behaviors. User behaviors might be the user opened the app, the user logged in, the user navigated to a specific view, or any user-triggered event that has Glean metrics associated with it."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/mobile-behavioral-targeting"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-behavioral-targeting" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/mobile-behavioral-targeting" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3554915a.css">
<link rel="preload" href="/assets/js/runtime~main.4e57a801.js" as="script">
<link rel="preload" href="/assets/js/main.fcaa93db.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11470446/Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What&#x27;s Newsletter</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Experimentation Workflow</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/overview">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Designing</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Implementing</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/experiment-owners">Experiment Owners</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/feature-definition">Feature Definition</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/a-b-experiments">A/B Experiments</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/custom-audiences">Custom Audiences</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/android-custom-targeting">Adding new targeting attributes to Android</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/workflow/ios-custom-targeting">Adding new targeting attributes to iOS</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Messaging Experiments on Firefox Desktop</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Messaging Experiments on Firefox for Mobile</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-messaging">Mobile Messaging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-behavioral-targeting">Behavioral Targeting</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Onboarding Experiments on Firefox for Mobile</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/configuring">Configuring</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Testing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/launching">Launching</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ending">Ending</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/analyzing">Analyzing</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Deep Dives</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Jetstream</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Data topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Desktop topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Mobile topics</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mobile-behavioral-targeting">Behavioral Targeting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-feature-api">Feature API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-first-run-experiments">First Run Experiments</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mobile-surveys">Surveys</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">nimbus-cli</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Experimenter topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Specifications</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Cookbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Links</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Behavioral Targeting</h1></header><p>Behavioral targeting is a term used to describe a set of jexl transforms which can be used to target specific user behaviors. User behaviors might be <code>the user opened the app</code>, <code>the user logged in</code>, <code>the user navigated to a specific view</code>, or any user-triggered event that has Glean metrics associated with it.</p><p>In order to maintain user privacy, this entire system lives in the Nimbus client launched by our mobile applications. Additionally, events are recorded and stored as counts in time interval-based buckets, allowing for a predictably small amount of disk spaceto be used for this event store.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="event-bucketing"></a>Event Bucketing<a class="hash-link" href="#event-bucketing" title="Direct link to heading">#</a></h2><p>Stored events are bucketed into time intervals. The time intervals are Minutes, Hours, Days, Weeks, Months, and Years. No additional setup is required for this bucketing process, it is handled entirely by the SDK. Buckets for each of the time intervals are created and stored whenever a new event is recorded.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="bucket-advancement--retention"></a>Bucket Advancement &amp; Retention<a class="hash-link" href="#bucket-advancement--retention" title="Direct link to heading">#</a></h3><p>When buckets are created, they have a starting date. This date is set to <code>Jan 1 00:00:00 UTC</code> of the current year. As time passes, the current time is incremented by the time difference in whole intervals and the buckets are advanced that many positions.</p><p>Bucket advancement occurs when an event is recorded, or when a query is performed. Buckets always advance based off whole increments of their time interval; <code>Minutes</code> will advance by full minutes, <code>Hours</code> by full hours, and so on. One exception to this rule is the <code>Months</code> time interval – it advances in increments of 28 days.</p><p>Based on the current datetime, the buckets may not advance at all, or may advance so much that all the buckets are cleared. As an example, if the current date for the <code>Hours</code> bucket is set to <code>May 1 10:00:00 UTC</code>, and an event is recorded at <code>May 1 12:45:00 UTC</code>, the buckets will be advanced 2 positions, the current date will be updated to <code>May 1 12:00:00 UTC</code>, and the event will be recorded in the bucket for the 12pm hour.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="retention"></a>Retention<a class="hash-link" href="#retention" title="Direct link to heading">#</a></h4><p>Each time interval has a maximum number of buckets it retains. As the time intervals move forward, buckets are rotated off of the deque and new buckets are added. If a query is performed that would go beyond the bucket count, it instead is cut off at the bucket count.</p><p>The following is a list of the time intervals and their bucket counts:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Minutes 60</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hours   24</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Days    56</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Weeks   52</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Months  12</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Years   4</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="querying-for-user-behavior"></a>Querying for User Behavior<a class="hash-link" href="#querying-for-user-behavior" title="Direct link to heading">#</a></h2><p>User behaviors are recorded in the same way as Glean events, and there are a number of ways in which they can be queried.</p><p>The following is a list of jexl transforms that exist within the Nimbus targeting helper, and thus are usable on all projects that use the Nimbus Rust library.</p><table><thead><tr><th align="left">Transform</th><th align="left">Description</th><th align="left">Args</th><th align="left">Returns</th></tr></thead><tbody><tr><td align="left"><code>eventSum</code></td><td align="left">Calculates the sum of all bucket values within the range</td><td align="left"><code>interval, bucket_count, starting_bucket</code></td><td align="left">int</td></tr><tr><td align="left"><code>eventCountNonZero</code></td><td align="left">Calculates the total number of buckets with a non-zero value within the range</td><td align="left"><code>interval, bucket_count, starting_bucket</code></td><td align="left">int</td></tr><tr><td align="left"><code>eventAverage</code></td><td align="left">Calculates the average of all event bucket values within the range</td><td align="left"><code>interval, bucket_count, starting_bucket</code></td><td align="left">float</td></tr><tr><td align="left"><code>eventAveragePerNonZeroInterval</code></td><td align="left">Calculates the average of all buckets with a non-zero value within the range</td><td align="left"><code>interval, bucket_count, starting_bucket</code></td><td align="left">float</td></tr><tr><td align="left"><code>eventLastSeen</code></td><td align="left">Returns the number of whole time intervals between the starting bucket and the first bucket with a non-zero value</td><td align="left"><code>interval, starting_bucket</code></td><td align="left">int</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="designing-experiments--behavior-triggers"></a>Designing Experiments &amp; Behavior Triggers<a class="hash-link" href="#designing-experiments--behavior-triggers" title="Direct link to heading">#</a></h2><p>The following are the existing options for behavioral targeting as defined in Experimenter (found under <code>Advanced Targeting</code> in the audience editor). In order to use these targeting options, the application must be Firefox or Focus for Android or iOS.</p><table><thead><tr><th align="left">Name</th><th align="left">Description</th><th align="left">Targeting String</th></tr></thead><tbody><tr><td align="left">Core Active Users</td><td align="left">A user who has used the application 21 out of the last 28 days.</td><td align="left"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;app-opened-event&#x27;|eventCountNonZero(&#x27;Days&#x27;, 28, 0) &gt;= 21</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></td></tr><tr><td align="left">Recently Logged In Users</td><td align="left">A user who has logged into Sync within the last 12 weeks.</td><td align="left"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;sync-signin-event&#x27;|eventCountNonZero(&#x27;Weeks&#x27;, 12, 0) &gt; 0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></td></tr></tbody></table><p>There are many ways these queries could be used to our advantage when writing behavior-oriented code. One example could be to show a certain message to users after they have launched the app <em>n</em> times, and after 12hrs has passed from when they first opened the application.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><pre tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">&#x27;app-opened-event&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">#</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token function" style="color:rgb(130, 170, 255)">eventSum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Years&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The sum of app opened events within the last four years must be 3 or more</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;app-opened-event&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">#</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token function" style="color:rgb(130, 170, 255)">eventSum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Hours&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The sum of app opened events within 12hrs, starting 12hrs ago</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;app-opened-event&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">#</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token function" style="color:rgb(130, 170, 255)">eventSum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Days&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The sum of app opened events within 7 days, starting 1 day ago</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;app-opened-event&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">#</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token function" style="color:rgb(130, 170, 255)">eventSum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Weeks&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">52</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The sum of app opened events within 52 weeks, starting 1 week ago</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">                                                            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Any one of these results must have been 1 or more</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="instrumented-events"></a>Instrumented Events<a class="hash-link" href="#instrumented-events" title="Direct link to heading">#</a></h2><p>The following are the events that are currently instrumented in Firefox for iOS and Android, respectively:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Android</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">iOS</li></ul><div class="margin-vert--md"><div role="tabpanel"><table><thead><tr><th align="left">Description</th><th align="left">Event</th></tr></thead><tbody><tr><td align="left">Application opened</td><td align="left"><a href="https://dictionary.telemetry.mozilla.org/apps/fenix/metrics/events_app_opened" target="_blank" rel="noopener noreferrer">app_opened</a></td></tr><tr><td align="left">User logged into Sync</td><td align="left"><a href="https://dictionary.telemetry.mozilla.org/apps/fenix/metrics/sync_auth_sign_in" target="_blank" rel="noopener noreferrer">sync_auth.sign_in</a></td></tr></tbody></table></div><div role="tabpanel" hidden=""><table><thead><tr><th align="left">Description</th><th align="left">Event</th></tr></thead><tbody><tr><td align="left">Application opened</td><td align="left"><a href="https://dictionary.telemetry.mozilla.org/apps/firefox_ios/metrics/app_cycle_foreground" target="_blank" rel="noopener noreferrer">app_cycle.foreground</a></td></tr><tr><td align="left">User logged into Sync</td><td align="left"><a href="https://dictionary.telemetry.mozilla.org/apps/firefox_ios/metrics/sync_login_completed_view" target="_blank" rel="noopener noreferrer">sync.login_completed_view</a></td></tr></tbody></table></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="engineering"></a>Engineering<a class="hash-link" href="#engineering" title="Direct link to heading">#</a></h2><p>In order to instrument a new behavior/event, an equivalent call to the Nimbus event recording method must be made alongside the call to record a Glean event.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>While this process is currently required, long-term we hope to have a hook in Glean that will record certain events automatically.</p></div></div><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Android</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">iOS</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>On Firefox for Android, a call should be made to <code>components.analytics.experiments.recordEvent</code> immediately following the Glean event being recorded. The argument should be the event name.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">app/src/main/java/org/mozilla/fenix/HomeActivity.kt</div><div class="codeBlockContent_hGly kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import org.mozilla.fenix.ext.components</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">open class HomeActivity : LocaleAwareAppCompatActivity(), NavHostActivity {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    final override fun onCreate(savedInstanceState: Bundle?) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (settings().isTelemetryEnabled) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            safeIntent</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ?.let(::getIntentSource)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ?.also {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Events.appOpened.record(Events.AppOpenedExtra(it))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    // This will record an event in Nimbus&#x27; internal event store. Used for behavioral targeting</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    components.analytics.experiments.recordEvent(&quot;app_opened&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="https://github.com/mozilla-mobile/fenix/pull/27934" target="_blank" rel="noopener noreferrer">Example in PR</a></p></div><div role="tabpanel" hidden=""><p>On Firefox for iOS, there is a wrapper for telemetry which makes this process rather simple. In the switch case for the event you want to implement, add a call to <code>Experiments.shared.recordEvent</code>. The argument should be the event name.</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">Client/Telemetry/TelemetryWrapper.swift</div><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension TelemetryWrapper {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    static func gleanRecordEvent(category: EventCategory, method: EventMethod, object: EventObject, value: EventValue? = nil, extras: [String: Any]? = nil) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        switch (category, method, object, value, extras) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case (.firefoxAccount, .view, .fxaLoginCompleteWebpage, _, _):</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            GleanMetrics.Sync.loginCompletedView.record()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // record the same event for Nimbus&#x27; internal event store</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Experiments.shared.recordEvent(&quot;sync.login_completed_view&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><a href="https://github.com/mozilla-mobile/firefox-ios/pull/12560" target="_blank" rel="noopener noreferrer">Example in PR</a></p></div></div></div><hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/deep-dives/mobile/behavioral-targeting.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mobile-messaging"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Mobile Messaging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/onboarding"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Onboarding Feature for Android »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#event-bucketing" class="table-of-contents__link">Event Bucketing</a><ul><li><a href="#bucket-advancement--retention" class="table-of-contents__link">Bucket Advancement &amp; Retention</a></li></ul></li><li><a href="#querying-for-user-behavior" class="table-of-contents__link">Querying for User Behavior</a></li><li><a href="#designing-experiments--behavior-triggers" class="table-of-contents__link">Designing Experiments &amp; Behavior Triggers</a></li><li><a href="#instrumented-events" class="table-of-contents__link">Instrumented Events</a></li><li><a href="#engineering" class="table-of-contents__link">Engineering</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4e57a801.js"></script>
<script src="/assets/js/main.fcaa93db.js"></script>
</body>
</html>