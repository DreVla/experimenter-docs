<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Configuring Jetstream | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/jetstream/configuration"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuring Jetstream | Experimenter Docs"><meta data-react-helmet="true" name="description" content="About configurations"><meta data-react-helmet="true" property="og:description" content="About configurations"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/jetstream/configuration"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/configuration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/configuration" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3554915a.css">
<link rel="preload" href="/assets/js/runtime~main.a14995be.js" as="script">
<link rel="preload" href="/assets/js/main.c9d630bb.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11470446/Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Welcome</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What&#x27;s Newsletter</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Workflow</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Deep Dives</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Jetstream</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/jetstream">Jetstream overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/statistics">Statistics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/outcomes">Outcomes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/jetstream/configuration">Configuring Jetstream</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/data-products">Jetstream Data Products</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/operations">Jetstream Architecture and Operations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/jetstream/troubleshooting">Troubleshooting Jetstream</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a href="https://github.com/mozilla/jetstream" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>GitHub Repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Data topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Desktop topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Mobile topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Experimenter topics</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Specifications</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Experimentation Cookbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Additional Links</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Frequently Asked Questions</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuring Jetstream</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="about-configurations"></a>About configurations<a class="hash-link" href="#about-configurations" title="Direct link to heading">#</a></h2><p>There are two ways to customize the results that appear in Experimenter and <a href="https://protosaur.dev/partybal/" target="_blank" rel="noopener noreferrer">partybal</a> for an experiment.</p><p>You can either reference an <a href="/jetstream/outcomes">outcome</a> while creating the experiment in the console,
or file a <a href="https://mozilla-hub.atlassian.net/jira/software/c/projects/DO/boards/269" target="_blank" rel="noopener noreferrer">jira ticket</a> to collaborate with a data scientist commit a custom configuration to the <a href="https://github.com/mozilla/jetstream-config" target="_blank" rel="noopener noreferrer">jetstream-config</a> repository.</p><p>Outcome definitions are also created in jetstream-config and use the same configuration language.</p><p>Custom experiment configurations are associated with an experiment by their filename,
which should match the experiment slug, like <code>my-experiment-slug.toml</code>.
This works for both Normandy and Nimbus slugs. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="landing-configurations"></a>Landing configurations<a class="hash-link" href="#landing-configurations" title="Direct link to heading">#</a></h2><p>To add or update a custom configuration, a data scientist will open a pull request against <a href="https://github.com/mozilla/jetstream-config" target="_blank" rel="noopener noreferrer">jetstream-config</a>.
CI checks will validate the columns, data sources, and SQL syntax. Note that if the experiment has not yet launched, the CI checks will not pass.
Once CI completes, you may merge the pull request, which will trigger Jetstream to re-run your analysis.
No additional review is necessary to land configurations. Results should be available in several hours, depending upon the complexity of the configuration.</p><p>Note that rerunning experiments may be costly!
Don&#x27;t let this stop you from doing your job,
but try to avoid too much iteration on large and long-running experiments.</p><p>Has your configuration landed but generated unexpected analyses? Troubleshooting information can be found <a href="https://experimenter.info/jetstream/troubleshooting" target="_blank" rel="noopener noreferrer">here</a> which includes instructions on accessing the Jetstream error logs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-file-syntax"></a>Configuration file syntax<a class="hash-link" href="#configuration-file-syntax" title="Direct link to heading">#</a></h2><p>Custom configs for <a href="#custom-experiment-configurations">experiments</a> and <a href="#outcome-snippets">outcome snippets</a>
analyzed in <a href="https://github.com/mozilla/jetstream" target="_blank" rel="noopener noreferrer">jetstream</a> use the same configuration language.</p><p>Custom configuration files are written in <a href="https://toml.io/en/" target="_blank" rel="noopener noreferrer">TOML</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="custom-experiment-configurations"></a>Custom experiment configurations<a class="hash-link" href="#custom-experiment-configurations" title="Direct link to heading">#</a></h3><p>Configuration files have four main sections:
<a href="#experiment-section"><code>[experiment]</code></a>, <a href="#metrics-section"><code>[metrics]</code></a>, <a href="#defining-data-sources"><code>[data_sources]</code></a>,
and <a href="#defining-segments"><code>[segments]</code></a>.</p><p>Examples of every value you can specify in each section are given below.
You do not need to, and should not, specify everything!
Jetstream will take values from Experimenter
and combine them with a reasonable set of defaults.</p><p>Lines starting with a <code>#</code> are comments and have no effect.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="experiment-section"></a>Experiment section<a class="hash-link" href="#experiment-section" title="Direct link to heading">#</a></h3><p>This part of the configuration file lets you</p><ul><li>specify the segments you wish to analyze,</li><li>override some values from Experimenter, and</li><li>define an exposure signal for your experiment.</li></ul><p>Segments are subsets of your enrolled population,
and depend on some factor that could be observed about the client
before they enrolled in the experiment.</p><p>Some segments <a href="https://docs.telemetry.mozilla.org/concepts/segments.html" target="_blank" rel="noopener noreferrer">are described in DTMO</a>,
and there are lists of predefined segments in the
<a href="https://mozilla.github.io/mozanalysis/api/segments/desktop.html" target="_blank" rel="noopener noreferrer">mozanalysis documentation</a>.</p><p>You can also override some values from Experimenter in the experiment section.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The segments that you wish to compute metrics for.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You can define your own later in the configuration,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># or (more commonly) use a value from mozanalysis.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The segment of all users is always computed.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">segments = [&quot;is_regular_user_v3&quot;, &quot;new_or_resurrected_v3&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Nominal length of the enrollment period in days.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Mozanalysis will consider enrollment_period + 1 &quot;dates&quot; of enrollments.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enrollment_period = 7</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The name of the control branch.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># To compare all branches to each other pairwise, use the value `nan`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reference_branch = &quot;control&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Override the &quot;enrollment query&quot; mozanalysis will use.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://github.com/mozilla/mozanalysis/issues/93 for more details about</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># what the query needs to contain.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># It must yield columns named client_id, branch, enrollment_date, and num_enrollment_events.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Jetstream interprets this as a Jinja2 template; an `experiment` object is provided</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># that lets you access other details from Experimenter, like a slug.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enrollment_query = &quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SELECT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      client_id,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      branch,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      enrollment_date,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      num_enrollments</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FROM mozdata.some_table.name_here</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  WHERE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DATE(submission_timestamp) BETWEEN &quot;{{experiment.start_date_str}}&quot; AND &quot;{{experiment.last_enrollment_date_str}}&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      AND mozfun.map.get_key(environment.experiments, &quot;{{experiment.slug}}&quot;) IS NOT NULL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You can override either or both of the start_date and end_date.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># In conjunction with a custom enrollment query, this can be useful for holdbacks,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># since you don&#x27;t really care about the period of time before your client upgrades</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># to the new version.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">start_date = &quot;2020-01-01&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end_date = &quot;2020-12-31&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># If you need Jetstream to decline to run analysis for an experiment,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># you can set this to true.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">skip = false</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You can override the exposure signal for the experiment if one is useful.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We&#x27;ll default to the Nimbus exposure event if one is not specified here.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment.exposure_signal]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name = &quot;nimbus&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Nimbus exposure signal&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Nimbus desktop feature exposure signal&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;normandy_events&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;event_method = &#x27;expose&#x27; AND event_string_value = &#x27;my_slug&#x27;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_start = &quot;enrollment_start&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_end = &quot;analysis_period_end&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should not define a <code>start_date</code> and <code>end_date</code> in your Jetstream configuration
unless it is important for your analysis that the deployment period is not the same as the analysis period.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="metrics-section"></a>Metrics section<a class="hash-link" href="#metrics-section" title="Direct link to heading">#</a></h3><p>The metrics section allows you to specify and define the metrics that you&#x27;re collecting,
the statistical summaries that you&#x27;d like applied to them, and any filters that you need.
See the <a href="https://docs.telemetry.mozilla.org/datasets/jetstream.html" target="_blank" rel="noopener noreferrer">Jetstream docmentation at DTMO</a> for more details on the analysis window concept.</p><p>You can use the names of pre-defined metrics defined in the <code>definitions/</code> directory of jetstream-config without redefining them.
See what <a href="https://mozilla.github.io/jetstream-config/metrics/firefox_desktop/" target="_blank" rel="noopener noreferrer">pre-defined metrics are available</a> for your platform.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each daily analysis window.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Defined as a list of strings. The string should be the &quot;slug&quot; of the metric,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># which is the name of the metric defined in `definitions/`, or the name</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># of the metric definition section in this config file (see below).</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daily = []</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each weekly analysis window.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">weekly = [&quot;uri_count&quot;, &quot;retained&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute for each 28 days long analysis window</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">28_day = [&quot;uri_count&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Metrics to compute only for the overall analysis window.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">overall = [&quot;uri_count&quot;, &quot;search_count&quot;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="defining-metrics"></a>Defining metrics<a class="hash-link" href="#defining-metrics" title="Direct link to heading">#</a></h3><p>You can define a new metric by adding a new section with a name like</p><p><code>[metrics.&lt;new_metric_slug&gt;]</code></p><p>For example, you could define a new metric based on a scalar named
<code>browser.engagement.cows_clicked</code> this way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># A clause of a SELECT expression. The expression must contain an aggregation function.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The expression is evaluated with `GROUP BY client_id, branch` over an analysis window.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Interpreted as a Jinja2 template. Various helper functions are available,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># so you could equivalently write the expression below like:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># select_expression = &quot;{{agg_sum(&quot;payload.processes.parent.scalars.browser_engagment_cows_clicked&quot;)}} &gt; 0&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://mozilla.github.io/jetstream-config/functions/ for details.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(COALESCE(payload.processes.parent.scalars.browser_engagement_cows_clicked)) &gt; 0&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The data source to use. You can use the slug of a data source defined in `definitions/`,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># or else define a new data source below.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;main&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Whether larger values of this metric are subjectively &quot;better&quot; or not.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># This defaults to true so you don&#x27;t need to specify it for engagement-type metrics</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># where we&#x27;re trying to encourage more of something. But for performance metrics,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># bigger is often worse, so you should set this to false.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bigger_is_better = true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># A friendly metric name displayed in dashboards.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Cows clicked&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># A description that will be displayed by dashboards.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Number of cows clicked&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Whether to compute the metric on an exposures basis, an enrollments basis, or both.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># An enrollments basis includes all users that enrolled. This is currently the default.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># An exposures basis includes all users that would have experienced a difference in their</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># user experience as a result of the experiment; it is a subset of enrollments.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># We may default to an exposures basis in the future.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exposure_basis = [&quot;exposures&quot;, &quot;enrollments&quot;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should also add some sections to describe how your new metrics should be summarized for reporting.
You can do this by adding a statistics section to the metric for the statistic you want.</p><p>See <a href="/jetstream/statistics">Statistics</a> for a list of supported statistics and details about implementing your own.</p><p>This looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows.statistics.binomial]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Sometimes it&#x27;s useful to specify a &quot;pre-treatment&quot; to drop extreme values</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># or perform a transformation. There is a list of these in the Jetstream wiki.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># They&#x27;re specified like this:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># pre_treatments = [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#     {name = &quot;drop_nulls&quot;},   # ⚠️ Use this pretreatment judiciously!</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # It can cause misleading results in</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # the presence of churn. Engagement metrics</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # should be coalesced to zero instead,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#                              # or you should handle zeros explicitly.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#     {name = &quot;log&quot;, base = 2},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># They don&#x27;t make much sense for a binomial statistic, though.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You can also change the default width of the confidence interval.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ci_width = 0.95</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To put it all together, the metrics section (without any comments) for this probe could look like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">weekly = [&quot;ever_clicked_cows&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(COALESCE(payload.processes.parent.scalars.browser_engagement_cows_clicked)) &gt; 0&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;main&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ever_clicked_cows.statistics.binomial]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="defining-data-sources"></a>Defining data sources<a class="hash-link" href="#defining-data-sources" title="Direct link to heading">#</a></h3><p>Most of the regular data sources are already defined in mozanalysis.
See what <a href="https://mozilla.github.io/jetstream-config/data_sources/firefox_desktop/" target="_blank" rel="noopener noreferrer">pre-defined data sources are available</a> for your platform.
You can also define a new one in a similar way to how new metrics are defined.</p><p>Add a section that looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[data_sources.my_cool_data_source]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># FROM expression - often just a fully-qualified table name. Sometimes a subquery.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from_expression = &quot;(SELECT client_id, experiments, submission_date FROM my_cool_table)&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://mozilla.github.io/mozanalysis/api/metrics.html#mozanalysis.metrics.DataSource for details.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">experiments_column_type = &quot;native&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, your new metric can refer to it like <code>data_source = &quot;my_cool_data_source&quot;</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="defining-segments"></a>Defining segments<a class="hash-link" href="#defining-segments" title="Direct link to heading">#</a></h3><p>You can define new segments, just like you can define new metrics.</p><p>This looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[segments.my_segment]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Note the aggregation function; these expressions are grouped over client_id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &#x27;{{agg_any(&quot;is_default_browser&quot;)}}&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;my_data_source&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[segments.data_sources.my_data_source]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from_expression = &#x27;(SELECT submission_date, client_id, is_default_browser FROM my_cool_table)&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Learn more about defining a segment data source in the <a href="https://mozilla.github.io/mozanalysis/api/segments.html#mozanalysis.segments.SegmentDataSource" target="_blank" rel="noopener noreferrer">mozanalysis documentation</a>.</p><p>The <code>clients_last_seen</code> table is particularly useful for segmentation because each client should be present on the <code>submission_date</code> when they enroll.
If you are not using <code>clients_last_seen</code>, you probably want to set the <code>window_start</code> argument for the segment data source to a value more negative than zero,
which controls how far back before enrollment mozanalysis will look to compute the segment expression.</p><p>For example, to aggregate over rows from the week prior to enrollment, the segment data source should be defined with <code>window_start = -7</code>.</p><p>To segment on fields in the telemetry environment, you can use the <code>event</code> ping table (not the derived <code>events</code> table) with no lookback period,
since the <code>event</code> ping that contains the enrollment event will necessarily be received
on the date of enrollment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="outcome-snippets"></a>Outcome snippets<a class="hash-link" href="#outcome-snippets" title="Direct link to heading">#</a></h3><p>Outcome snippets, which define a collection of summaries with a common theme (e.g. &quot;performace&quot;, &quot;Picture in Picture use&quot;),
are stored in the <code>outcomes/</code> directory and file names serve as unique identifiers. Outcome snippets are organized in different
subdirectories that represent the application they are supporting, e.g. <code>fenix/</code> or <code>firefox_desktop/</code>.</p><p>Configuration files have a set of <a href="#defining-metrics"><code>[metrics]</code> definitions</a> and <a href="#defining-data-sources"><code>[data_sources]</code></a>.
A <code>friendly_name</code> and <code>description</code> are required at the top of the outcome snippet config file.</p><p>Unlike experiment configurations, the <code>[metrics]</code> section does not specify the analysis windows metrics
are computed for. Jetstream computes metrics defined in outcome snippets for weekly and overall
analysis windows.</p><p><code>select_expression</code> in Outcomes supports parameterization. This enables Outcomes to be reused as values specified in an external jetstream config to be injected into the <code>select_expression</code>.
Outcome snippets look, for example, like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &#x27;Example config&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &#x27;Example outcome snippet&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># parameters definition (Optional)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[parameters.search_engine]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Search engine&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Search engine we want to track&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default = &quot;google&quot;  # this will be the default value if not overwritten in an external config</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">distinct_by_branch = false  # if set to true, value provided in config needs to specify value and corresponding id.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;SUM(CASE WHEN engine like &#x27;amazon%&#x27; then sap else 0 end)&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;search_clients_engines_sources_daily&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count.statistics.bootstrap_mean]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.total_amazon_search_count.statistics.deciles]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUM(CASE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;alias&#x27; AND engine LIKE &#x27;amazon%&#x27; THEN sap</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;urlbar&#x27; AND engine LIKE &#x27;amazon%&#x27; THEN sap</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        WHEN source = &#x27;urlbar-searchmode&#x27; AND engine LIKE &#x27;amazon%&#x27; THEN sap</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        else 0 end)&quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;search_clients_engines_sources_daily&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.dummy_metric]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COUNTIF(engine = &#x27;{{parameters.search_engine}}&#x27;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;search_clients_engines_sources_daily&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count.statistics.bootstrap_mean]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.urlbar_amazon_search_count.statistics.deciles]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="overwriting-outcomes-parameters"></a>Overwriting Outcomes parameters<a class="hash-link" href="#overwriting-outcomes-parameters" title="Direct link to heading">#</a></h3><p><strong>distinct_by_branch set to false</strong> example:</p><p>External config:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Amazon Search&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[parameters.search_engine]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value = &quot;amazon&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>select_expression</code> for metric <code>metrics.dummy_metric</code> will now look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">COUNTIF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">engine</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;amazon&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><code>distinct_by_branch</code> set to <code>true</code></strong> example:</p><p>External config:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Amazon Search&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[parameters.id]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">distinct_by_branch = true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># value.[corresponding_branch_name] = [value]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value.experiment_branch_name_1 = &quot;google&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value.experiment_branch_name_2 = &quot;amazon&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>select_expression</code> for metric <code>metrics.dummy_metric</code> will now look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">COUNTIF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">branch_name </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;experiment_branch_name_1&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;google&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;experiment_branch_name_2&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;amazon&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="defining-exposure-signals"></a>Defining Exposure Signals<a class="hash-link" href="#defining-exposure-signals" title="Direct link to heading">#</a></h3><p>Many Nimbus features will send a <a href="/mobile-feature-api#recording-exposure-events">Nimbus exposure event</a> automatically when the feature configuration is consulted;
these are <code>normandy#expose</code> events on desktop and <code>nimbus_events.exposure</code> events in Glean.
However, it is also possible to define custom exposure events:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment.exposure_signal]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name = &quot;nimbus&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">friendly_name = &quot;Nimbus exposure signal&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description = &quot;Nimbus desktop feature exposure signal&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_source = &quot;events&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expression = &quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   event_category = &#x27;normandy&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   AND event_method = &#x27;expose&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   AND event_object = &#x27;nimbus_experiment&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   AND event_string_value = &#x27;experiment-slug&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   AND normalized_channel = &#x27;release&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_start = 0                    # optional</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_end = &quot;analysis_window_end&quot;  # optional</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>select_expression</code>: Defines the condition for when an exposure happens. </li><li><code>data_source</code>: Specifies the dataset on which to apply the <code>select_expression</code>. Can use <a href="https://mozilla.github.io/mozanalysis/api/metrics.html#mozanalysis.metrics.DataSource" target="_blank" rel="noopener noreferrer">predefined</a> or custom data sources. </li><li><code>window_start</code> and <code>window_end</code>: Optional parameters that specify the date range when clients are checked for exposure. Defaults to <code>window_start = &#x27;enrollment_start&#x27;</code> and <code>window_end = &#x27;enrollment_end&#x27;</code>. Other valid values include:<ul><li>Any positive integer: The number of days after the first enrollment date. </li><li>Any negative integer: The number of days before the first enrollment date. </li><li><code>enrollment_start</code>: Equivalent to using <code>0</code></li><li><code>enrollment_end</code>: Equivalent to using the enrollment period length in days</li><li><code>analysis_window_start</code>: The start of the current analysis window</li><li><code>analysis_window_end</code>: The end of the current analysis window</li></ul></li></ul><p>Metrics based on clients that have seen the exposure signal are only computed for those that specify <code>exposures</code> as one of their <code>analysis_bases</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[metrics.ad_clicks]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">analysis_bases = [&quot;exposures&quot;, &quot;enrollments&quot;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Using <code>window_start</code> and <code>window_end</code> it is possible to consider clients as exposed/non-exposed during the observation period. For example, if clients should only be considered as exposed during an analysis window:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment.exposure_signal]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_start = &quot;analysis_window_start&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_end = &quot;analysis_window_end&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Or, if clients should be considered as exposed if they have received the exposure signal during the current analysis window or any time before:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[experiment.exposure_signal]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_start = &quot;enrollment_start&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_end = &quot;analysis_window_end&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Results for exposure based metrics are currently not visualized in Experimenter. To access results, the BigQuery tables need to be queried directly.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/jetstream/configuration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/jetstream/outcomes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Outcomes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/jetstream/data-products"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Jetstream Data Products »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-configurations" class="table-of-contents__link">About configurations</a></li><li><a href="#landing-configurations" class="table-of-contents__link">Landing configurations</a></li><li><a href="#configuration-file-syntax" class="table-of-contents__link">Configuration file syntax</a><ul><li><a href="#custom-experiment-configurations" class="table-of-contents__link">Custom experiment configurations</a></li><li><a href="#experiment-section" class="table-of-contents__link">Experiment section</a></li><li><a href="#metrics-section" class="table-of-contents__link">Metrics section</a></li><li><a href="#defining-metrics" class="table-of-contents__link">Defining metrics</a></li><li><a href="#defining-data-sources" class="table-of-contents__link">Defining data sources</a></li><li><a href="#defining-segments" class="table-of-contents__link">Defining segments</a></li><li><a href="#outcome-snippets" class="table-of-contents__link">Outcome snippets</a></li><li><a href="#overwriting-outcomes-parameters" class="table-of-contents__link">Overwriting Outcomes parameters</a></li><li><a href="#defining-exposure-signals" class="table-of-contents__link">Defining Exposure Signals</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a14995be.js"></script>
<script src="/assets/js/main.c9d630bb.js"></script>
</body>
</html>