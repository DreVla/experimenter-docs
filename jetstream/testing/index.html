<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Experimenter Docs" href="/opensearch.xml"><title data-react-helmet="true">Testing Jetstream Configs | Experimenter Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://experimenter.info/jetstream/testing"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Testing Jetstream Configs | Experimenter Docs"><meta data-react-helmet="true" name="description" content="Validation via Continuous Integration (CI)"><meta data-react-helmet="true" property="og:description" content="Validation via Continuous Integration (CI)"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://experimenter.info/jetstream/testing"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://experimenter.info/jetstream/testing" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3554915a.css">
<link rel="preload" href="/assets/js/runtime~main.0a989c0f.js" as="script">
<link rel="preload" href="/assets/js/main.66c3555d.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.svg" alt="Experimenter Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mozilla Experimentation and Feature Delivery</b></a></div><div class="navbar__items navbar__items--right"><a href="https://experimenter.services.mozilla.com/nimbus/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Nimbus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://mozilla-hub.atlassian.net/wiki/spaces/FJT/pages/11470446/Nimbus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Confluence<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/mozilla/experimenter-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Testing Jetstream Configs</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="validation-via-continuous-integration-ci"></a>Validation via Continuous Integration (CI)<a class="hash-link" href="#validation-via-continuous-integration-ci" title="Direct link to heading">#</a></h2><p>Configurations for Jetstream experiments get added by opening a pull-request in the <a href="https://github.com/mozilla/metric-hub/tree/main/jetstream" target="_blank" rel="noopener noreferrer">metric-hub</a> repository. Continuous Integration (CI) automatically runs checks to validate that the syntax and SQL definitions of the new or updated configuration files is correct. These checks only run for pull-requests that are opened from a branch that was pushed to the metric-hub repository. For pull-requests based on forks only some checks will run.</p><p>Pull-requests that pass the CI validation can be automatically merged without requiring an external review.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="local-validation"></a>Local validation<a class="hash-link" href="#local-validation" title="Direct link to heading">#</a></h2><p>To locally iterate and validate Jetstream configurations, the Jetstream tooling needs to be installed: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip install mozilla-jetstream</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once installed, local config files can be valided using the <code>jetstream validate_config</code> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jetstream validate_config /local/path/to/config/file.toml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In case changes have been made to outcomes, defaults or metric definitions it is possible to specify a local metric-hub directory to be used for validation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jetstream validate_config /local/path/to/config/file.toml --config_repos=/path/to/metric-hub</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="jetstream-previews"></a>Jetstream previews<a class="hash-link" href="#jetstream-previews" title="Direct link to heading">#</a></h2><p>When iterating on configurations, it is sometimes useful to get a preview of what computed data on the final dashboard would look like. Previews are computed on a data sample in order to reduce cost and speed up the analysis. Preview data should not be used to draw any conclusions on the outcome of an experiment. It should only be used to validate configurations.</p><p>To generate previews, install the Jetstream CLI tooling locally:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip install mozilla-jetstream</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Authenticate to GCP:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud auth login --update-adc</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And set the project to <code>mozdata</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gcloud config set project mozdata</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is the default project where preview data will be temporarily be stored in. It is also possible to set this project to a personal sandbox project, or any other project with write permissions.</p><p>Preview data can be generated using the <code>jetstream preview</code> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jetstream preview --help                  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Usage: jetstream preview [OPTIONS]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Create a preview for a specific experiment based on a subset of data.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Options:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --project_id, --project-id TEXT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Project to write to (default: mozdata)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --dataset_id, --dataset-id TEXT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Dataset to write to (default: tmp)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --start_date, --start-date YYYY-MM-DD</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Date for which project should be started to</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  get analyzed. Default: current date - 3 days</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --end_date, --end-date YYYY-MM-DD</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Date for which project should be stop to get</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  analyzed. Default: current date</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --num-days, --num-days INTEGER  Number of days for which the project be</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  analyzed. Default: 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --experiment_slug, --experiment-slug TEXT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Experimenter or Normandy slug of the</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  experiment to (re)run analysis for</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --config_file, --config-file FILENAME</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --config_repos, --config-repos TEXT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  URLs to public repos with configs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --private_config_repos, --private-config-repos TEXT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  URLs to private repos with configs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --analysis_periods, --analysis-periods ANALYSISPERIOD</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Analysis periods to run analysis for.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --sql-output-dir, --sql_output_dir OUTDIR</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Write generated SQL to given directory</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --platform TEXT                 Platform/app to run analysis for. If not</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  specified, use Experimenter API to determine</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  plaftorm  [required]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --generate-population, --generate_population</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Generate a random population sample based on</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  the provided population size. Useful if</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  enrollment hasn&#x27;t happened yet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --population-sample-size, --population_sample_size INTEGER</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Generated population sample size. Only used</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  when `--generate-population` is specified.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Use floats to specify population sizes in</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  percent, e.g 0.01 == 1% of clients</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --enrollment_period, --enrollment-period INTEGER</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  Numer of days used as enrollment period when</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  generating population.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --help                          Show this message and exit.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By default the preview runs Hetstream on a 3 day analysis window on a population sample of 1%.
These default parameters can be overwritten when invoking <code>jetstream preview</code>.</p><p>The resulting data artifacts get written into the <code>mozdata.tmp</code> dataset by default, which is configured to delete data after 7 days. Anyone at Mozilla has permissions to write to this dataset.</p><p>To generate a preview on a 10% sample for an existing experiment on Firefox iOS run:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jetstream preview \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --experiment_slug=ios-search-bar-placement-impact-assessment \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --start_date=2022-08-01 \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --platform=firefox_ios \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --population-sample-size=10</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Jetstream Preview fetches experiment information from the Experimenter API.
In some cases a preview might need to be generated for experiments that haven&#x27;t been launched yet or that haven&#x27;t seen any enrollments. For these experiments a random population sample can be generated when specifying <code>--generate-population</code> that will be considered as the clients that enrolled:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jetstream preview \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --config_file=/path/to/local/config.toml \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --start_date=2023-01-01 \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --platform=firefox_deskop \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --generate-population \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --population-sample-size=1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once preview data has been computed, a link to a Looker dashboard will be printed where data for each metric and statistic is visualized:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">A preview is available at: https://mozilla.cloud.looker.com/dashboards/experimentation::jetstream_preview?Project=&#x27;mozdata&#x27;&amp;Dataset=&#x27;tmp&#x27;&amp;Slug=&#x27;ios_search_bar_placement_impact_assessment&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><img src="/img/jetstream/jetstream-preview.png" alt="Jetstream Preview Looker Dashboard" class="img-sm"><p>The dashboard shows the computed statistics for each metric in a graph, raw results as they show up in the BigQuery table as well as logs that were written during the analysis. Some additional metadata about the experiment is shown at the top. Also a cost estimate is provided. The estimate is based on the sampled data, as well as a subset of analyses periods and days. The final cost will be much higher.</p><p>The preview data gets written into the <code>tmp</code> dataset in the <code>mozdata</code> project by default. Data written to this dataset gets automatically removed after 7 days.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/experimenter-docs/edit/main/docs/jetstream/testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#validation-via-continuous-integration-ci" class="table-of-contents__link">Validation via Continuous Integration (CI)</a></li><li><a href="#local-validation" class="table-of-contents__link">Local validation</a></li><li><a href="#jetstream-previews" class="table-of-contents__link">Jetstream previews</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Mozilla Corporation</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a989c0f.js"></script>
<script src="/assets/js/main.66c3555d.js"></script>
</body>
</html>